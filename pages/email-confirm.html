<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Verification - Nhat Nguyen</title>
    <link rel="stylesheet" href="../src/css/main.css">
    <link rel="stylesheet" href="../src/css/components/toast.css">
    <script src="https://unpkg.com/validator@latest/validator.min.js"></script>
    <style>
        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success-checkmark {
            animation: checkmark 0.6s ease-in-out;
        }

        @keyframes checkmark {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .error-shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="font-inter-tight text-base min-h-screen flex flex-col">
    <!-- Navigation -->
    <header class="nav-energy">
        <nav class="max-w-6xl mx-auto flex items-center justify-between px-6 py-4">
            <a href="/" class="nav-logo">
                NN
                <span class="nav-logo-dot"></span>
            </a>
            <ul class="hidden md:flex items-center gap-8">
                <li><a class="nav-link" href="/pages/about-me.html">About</a></li>
                <li><a class="nav-link" href="/">Articles</a></li>
            </ul>
            <div class="flex items-center gap-3">
                <a href="/pages/login.html" class="btn-energy btn-energy-primary text-sm py-2.5 px-5">Get Started</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex items-center justify-center pt-24 pb-16 px-6">
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-8 max-w-md w-full text-center fade-in">
            <!-- Loading State -->
            <div id="loading-state" class="block">
                <div class="loading-spinner w-16 h-16 border-4 border-red-100 border-t-red-500 rounded-full mx-auto mb-6"></div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Verifying Your Email</h2>
                <p class="text-gray-600">Please wait while we confirm your email address...</p>
            </div>

            <!-- Success State -->
            <div id="success-state" class="hidden">
                <div class="success-checkmark w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Email Verified Successfully!</h2>
                <p class="text-gray-600 mb-6">Your account has been activated. You can now access all features.</p>
                <div class="space-y-3">
                    <button id="continue-btn" class="btn-energy btn-energy-primary w-full justify-center">
                        Continue to Dashboard
                    </button>
                    <button id="login-btn" class="btn-energy btn-energy-outline w-full justify-center">
                        Go to Login
                    </button>
                </div>
            </div>

            <!-- Error State -->
            <div id="error-state" class="hidden">
                <div class="error-shake w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Verification Failed</h2>
                <p id="error-message" class="text-gray-600 mb-6">The verification link is invalid or has expired. Please request a new verification email.</p>
                <div class="space-y-3">
                    <button id="resend-btn" class="btn-energy btn-energy-primary w-full justify-center">
                        Resend Verification Email
                    </button>
                    <button id="back-home-btn" class="btn-energy btn-energy-outline w-full justify-center">
                        Back to Home
                    </button>
                </div>
            </div>

            <!-- Expired State -->
            <div id="expired-state" class="hidden">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Link Expired</h2>
                <p class="text-gray-600 mb-6">This verification link has expired for security reasons. Please request a new one.</p>
                <div class="space-y-3">
                    <button id="new-link-btn" class="btn-energy btn-energy-primary w-full justify-center">
                        Get New Verification Link
                    </button>
                    <button id="contact-support-btn" class="btn-energy btn-energy-outline w-full justify-center">
                        Contact Support
                    </button>
                </div>
            </div>

            <!-- Footer Branding -->
            <div class="mt-8 pt-6 border-t border-gray-100">
                <div class="flex items-center justify-center mb-4">
                    <a href="/" class="nav-logo text-xl">
                        NN
                        <span class="nav-logo-dot"></span>
                    </a>
                </div>
                <p class="text-sm text-gray-500">
                    Need help? <a href="mailto:support@nhatnguyen.dev" class="text-red-500 hover:underline">Contact Support</a>
                </p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer-energy py-12">
        <div class="max-w-6xl mx-auto px-6">
            <div class="footer-divider pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="footer-copyright">&copy; 2024 Nhat Nguyen. All rights reserved.</p>
                <div class="flex gap-6">
                    <a href="/" class="footer-link">Home</a>
                    <a href="/pages/about-me.html" class="footer-link">About</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        class EmailVerification {
            constructor() {
                this.init();
            }

            init() {
                const urlParams = new URLSearchParams(window.location.search);
                const token = urlParams.get('token');

                if (!token) {
                    this.showError('No verification token found in URL');
                    return;
                }

                this.verifyEmail(token);
                this.setupEventListeners();
            }

            async verifyEmail(token) {
                try {
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    const response = await this.mockApiCall(token);

                    if (response.success) {
                        this.showSuccess();
                    } else if (response.expired) {
                        this.showExpired();
                    } else {
                        this.showError(response.message);
                    }
                } catch (error) {
                    this.showError('Network error. Please try again.');
                }
            }

            async mockApiCall(token) {
                const mockResponses = [
                    { success: true },
                    { success: false, expired: true },
                    { success: false, message: 'Invalid token' },
                    { success: false, message: 'User already verified' }
                ];

                return mockResponses[0];
            }

            showLoading() {
                this.hideAllStates();
                document.getElementById('loading-state').classList.remove('hidden');
            }

            showSuccess() {
                this.hideAllStates();
                document.getElementById('success-state').classList.remove('hidden');
            }

            showError(message) {
                this.hideAllStates();
                document.getElementById('error-state').classList.remove('hidden');
                document.getElementById('error-message').textContent = message;
            }

            showExpired() {
                this.hideAllStates();
                document.getElementById('expired-state').classList.remove('hidden');
            }

            hideAllStates() {
                const states = ['loading-state', 'success-state', 'error-state', 'expired-state'];
                states.forEach(state => {
                    document.getElementById(state).classList.add('hidden');
                });
            }

            setupEventListeners() {
                document.getElementById('continue-btn')?.addEventListener('click', () => {
                    window.location.href = '/';
                });

                document.getElementById('login-btn')?.addEventListener('click', () => {
                    window.location.href = '/pages/login.html';
                });

                document.getElementById('resend-btn')?.addEventListener('click', () => {
                    this.resendVerificationEmail();
                });

                document.getElementById('back-home-btn')?.addEventListener('click', () => {
                    window.location.href = '/';
                });

                document.getElementById('new-link-btn')?.addEventListener('click', () => {
                    this.requestNewLink();
                });

                document.getElementById('contact-support-btn')?.addEventListener('click', () => {
                    window.location.href = 'mailto:support@nhatnguyen.dev';
                });
            }

            async resendVerificationEmail() {
                try {
                    const button = document.getElementById('resend-btn');
                    const originalText = button.textContent;
                    button.textContent = 'Sending...';
                    button.disabled = true;

                    await new Promise(resolve => setTimeout(resolve, 1500));

                    alert('Verification email sent! Please check your inbox.');

                    button.textContent = originalText;
                    button.disabled = false;
                } catch (error) {
                    alert('Failed to send email. Please try again.');
                }
            }

            async requestNewLink() {
                try {
                    const button = document.getElementById('new-link-btn');
                    const originalText = button.textContent;
                    button.textContent = 'Sending...';
                    button.disabled = true;

                    await new Promise(resolve => setTimeout(resolve, 1500));

                    alert('New verification link sent! Please check your email.');

                    button.textContent = originalText;
                    button.disabled = false;
                } catch (error) {
                    alert('Failed to send new link. Please try again.');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new EmailVerification();
        });
    </script>
</body>
</html>
